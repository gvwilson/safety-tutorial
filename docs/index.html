<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<script src="https://kit.fontawesome.com/4eee35f757.js"></script>
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
<link rel="stylesheet" href="github.css" type="text/css">
<link rel="stylesheet" href="tutorial.css" type="text/css">
<script defer data-domain="gvwilson.github.io/safety-tutorial" src="https://plausible.io/js/script.js"></script>
<title>Computer Security for Wary Data Scientists</title>

  </head>
  <body>
    <nav>
  <div class="row underline">
    <div class="col-2 left">
      <a class="navlink" href="#">Home</a>
    </div>
    <div class="col-10 right">
      <a href="https://github.com/gvwilson/safety-tutorial">repo</a>
      <a href="https://github.com/gvwilson/safety-tutorial/raw/main/safety-tutorial.zip">download</a>
      <a class="navlink" href="license/">license</a>
      <a class="navlink" href="conduct/">conduct</a>
      <a class="navlink" href="contributing/">contributing</a>
      <a class="navlink" href="colophon/">colophon</a>
    </div>
  </div>
</nav>

    <main>
      
  <h1>Computer Security for Wary Data Scientists</h1>
  <p class="subtitle"></p>


      <!-- ---------------------------------------------------------------- -->
<section class="aside">
<h2 class="aside">What This Is</h2>
<ul>
<li>Notes and working examples that instructors can use to perform a lesson<ul>
<li>Do <em>not</em> expect novices with no prior Python or Unix experience to be able to learn from them</li>
</ul>
</li>
<li>Musical analogy<ul>
<li>This is the chord changes and melody</li>
<li>We expect instructors to create an arrangement and/or improvise while delivering</li>
</ul>
</li>
<li>Please see <a href="./license/">the license</a> for terms of use,
    the <a href="./conduct/">Code of Conduct</a> for community standards,
    and <a href="./contributing/">these guidelines</a> for notes on contributing</li>
<li>About the author:
    <a href="https://third-bit.com/">Greg Wilson</a> is a programmer, author, and educator based in Toronto<ul>
<li>Co-founder and first Executive Director of <a href="https://carpentries.org/">Software Carpentry</a></li>
<li>Currently a senior software engineering manager at a startup in Toronto</li>
</ul>
</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="aside">
<h2 class="aside">Scope</h2>
<ul>
<li><a href="http://teachtogether.tech/en/index.html#s:process-personas">Intended audience</a><ul>
<li>Ning did a bachelor&rsquo;s degree in economics
    and now works as a data analyst for the Ministry of Health</li>
<li>They learned Python in an intensive 16-week data science bootcamp program
    and are comfortable working with Unix command-line tools,
    writing data analysis programs in Python,
and downloading data from the web to use in those programs</li>
<li>Ning wants to build real-time dashboards for people in the Ministry,
    but doesn&rsquo;t understand how to do that
without exposing confidential data or opening the Ministry up to attack</li>
<li>Their work schedule is unpredictable and highly variable,
    so they need to be able to learn a bit at a time</li>
</ul>
</li>
<li>Prerequisites<ul>
<li>Intermediate Unix command line: <code>find</code>, <code>grep</code>, shell scripts using <code>for</code></li>
<li>Data analysis with Python: Polars, Plotly, Jupyter notebooks, argparse, regular expressions</li>
<li>Using Git and GitHub on months-long projects with two or three colleagues</li>
</ul>
</li>
<li>Learning outcomes<ol>
<li>TODO</li>
</ol>
</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="aside">
<h2 class="aside">What We&rsquo;re Going to Do</h2>
<ol>
<li>Show how the basic components of the web work.</li>
<li>Build a simple application that serves up data from files and a database.</li>
<li>Fix its safety issues one by one.</li>
</ol>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="aside">
<h2 class="aside">Setup</h2>
<ul>
<li>Download <a href="https://github.com/gvwilson/safety-tutorial/raw/main/safety-tutorial.zip">the latest release</a></li>
<li>Unzip the file in a temporary directory to create:<ul>
<li><code>./src/*.*</code>: shell scripts and Python programs</li>
<li><code>./site/*.*</code>: the pages and data files used in the examples</li>
<li><code>./out/*.*</code>: expected output for examples</li>
</ul>
</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="aside">
<h2 class="aside">Start with Something Simple</h2>
<p class="inclusion"><a href="src/requests_get_motto.py">src/requests_get_motto.py</a></p>
<div class="language-py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://gvwilson.github.io/safety-tutorial/site/motto.txt&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;body:</span><span class="se">\n</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<p class="inclusion"><a href="out/requests_get_motto.out">out/requests_get_motto.out</a></p>
<div class="language-plaintext">
<div class="highlight"><pre><span></span><code>status code: 200
body:
Start where you are, use what you have, help who you can.
</code></pre></div>
</div>
<ul>
<li>Use the <a href="https://requests.readthedocs.io/en/latest/"><code>requests</code></a> module (needs to be installed)</li>
<li>The URL identifies the file we want<ul>
<li>Though as we&rsquo;ll see, the server can interpret it differently</li>
</ul>
</li>
<li>Response includes:<ul>
<li><a href="#g:http_status_code">HTTP status code</a> such as 200 (OK) or 404 (Not Found)</li>
<li>The text of the response</li>
</ul>
</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="aside">
<h2 class="aside">What Just Happened</h2>
<figure id="figure_1">
<img src="img/http_lifecycle.svg" alt="HTTP request/response lifecycle"/>
<figcaption>Figure 1: Lifecycle of an HTTP request and response</figcaption>
</figure>
<ul>
<li>Open a connection to the server</li>
<li>Send an <a href="#g:http_request">HTTP request</a> for the file we want</li>
<li>Server creates a <a href="#g:http_response">response</a> that includes the contents of the file</li>
<li>Sends it back</li>
<li><code>requests</code> parses the response and creates a Python object for us</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">1: Request Structure</h2>
<p class="inclusion"><a href="src/requests_prepared_structure.py">src/requests_prepared_structure.py</a></p>
<div class="language-py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">requests_toolbelt.utils</span> <span class="kn">import</span> <span class="n">dump</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://gvwilson.github.io/safety-tutorial/site/motto.txt&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dump</span><span class="o">.</span><span class="n">dump_all</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
</code></pre></div>
</div>
<p class="inclusion"><a href="out/requests_prepared_structure.out">out/requests_prepared_structure.out</a></p>
<div class="language-plaintext">
<div class="highlight"><pre><span></span><code>GET /safety-tutorial/site/motto.txt HTTP/1.1
Host: gvwilson.github.io
User-Agent: python-requests/2.31.0
Accept-Encoding: gzip, deflate
Accept: */*
Connection: keep-alive
</code></pre></div>
</div>
<ul>
<li>First line is <a href="#g:http_method">method</a>, URL, and protocol version</li>
<li>Every HTTP request can have <a href="#g:http_header">headers</a> with extra information</li>
<li>And optionally data being uploaded (which we will see later)</li>
<li>Yes, it&rsquo;s all just text</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">2: Response Structure</h2>
<p class="inclusion"><a href="src/show_response_headers.py">src/show_response_headers.py</a></p>
<div class="language-py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://gvwilson.github.io/web-tutorial/site/motto.txt&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<p class="inclusion"><a href="out/show_response_headers.out">out/show_response_headers.out</a></p>
<div class="language-plaintext">
<div class="highlight"><pre><span></span><code>Connection: keep-alive
Content-Length: 5142
Server: GitHub.com
Content-Type: text/html; charset=utf-8
permissions-policy: interest-cohort=()
ETag: W/&quot;65c56fc7-239b&quot;
Content-Security-Policy: default-src &#39;none&#39;; style-src &#39;unsafe-inline&#39;; img-src data:; connect-src &#39;self&#39;
Content-Encoding: gzip
X-GitHub-Request-Id: A08C:5A357:7CF794:9CEA06:65D13923
Accept-Ranges: bytes
Date: Sat, 17 Feb 2024 22:54:27 GMT
Via: 1.1 varnish
Age: 0
X-Served-By: cache-yyz4563-YYZ
X-Cache: MISS
X-Cache-Hits: 0
X-Timer: S1708210467.301651,VS0,VE20
Vary: Accept-Encoding
X-Fastly-Request-ID: cb16df2dfa73aaf6de87924c743dd1e50a0ce570
</code></pre></div>
</div>
<ul>
<li>Every HTTP response also has with extra information<ul>
<li>Does <em>not</em> include status code: that appears in the first line</li>
</ul>
</li>
<li>Most important for now are:<ul>
<li><code>Content-Length</code>: number of bytes in response data (i.e., how much to read)</li>
<li><code>Content-Type</code>: <a href="#g:mime_type">MIME type</a> of data (e.g., <code>text/plain</code>)</li>
</ul>
</li>
<li>From now on we will only show interesting headers</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="exercise">
<h2 class="exercise">Practice</h2>
<p><strong>Exercise 1</strong>:
Add header called <code>Studying</code> with the value <code>safety</code> to the <code>requests</code> script shown above.
Does it make a difference to the response?
Should it?</p>
<p><strong>Exercise 2</strong>:
What is the difference between the <code>Content-Type</code> and the <code>Content-Encoding</code> headers?</p>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">3: When Things Go Wrong</h2>
<p class="inclusion"><a href="src/get_nonexistent_file.py">src/get_nonexistent_file.py</a></p>
<div class="language-py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://gvwilson.github.io/web-tutorial/site/nonexistent.txt&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;body length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<p class="inclusion"><a href="out/get_nonexistent_file.out">out/get_nonexistent_file.out</a></p>
<div class="language-plaintext">
<div class="highlight"><pre><span></span><code>status code: 404
body length: 9115
</code></pre></div>
</div>
<ul>
<li>The 404 status code tells us something went wrong</li>
<li>The 9 kilobyte response is an HTML page with an embedded image (the GitHub logo)</li>
<li>The page contains human-readable error messages<ul>
<li>But we have to know page format to pull them out</li>
</ul>
</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="exercise">
<h2 class="exercise">Practice</h2>
<p><strong>Exercise 3</strong>:
Look at <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">this list of HTTP status codes</a>.</p>
<ol>
<li>
<p>What is the difference between status code 403 and status code 404?</p>
</li>
<li>
<p>What is status code 418 used for?</p>
</li>
<li>
<p>Under what circumstances would you expect to get a response whose status code is 505?</p>
</li>
</ol>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">4: Getting JSON</h2>
<p class="inclusion"><a href="src/requests_get_json.py">src/requests_get_json.py</a></p>
<div class="language-py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://gvwilson.github.io/web-tutorial/site/motto.json&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;body as text: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>
<span class="n">as_json</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;body as JSON:</span><span class="se">\n</span><span class="si">{</span><span class="n">as_json</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<p class="inclusion"><a href="out/requests_get_json.out">out/requests_get_json.out</a></p>
<div class="language-plaintext">
<div class="highlight"><pre><span></span><code>status code: 200
body as text: 107 bytes
body as JSON:
{&#39;first&#39;: &#39;Start where you are&#39;, &#39;second&#39;: &#39;Use what you have&#39;, &#39;third&#39;: &#39;Help who you can&#39;}
</code></pre></div>
</div>
<ul>
<li>Parsing data out of HTML is called <a href="#g:web_scraping">web scraping</a><ul>
<li>Painful and error prone</li>
</ul>
</li>
<li>Better to have the server return data as data<ul>
<li>Preferred format these days is <a href="#g:json">JSON</a></li>
<li>So common that <code>requests</code> has built-in support</li>
</ul>
</li>
<li>There is no standard for representing tabular data as JSON<ul>
<li>A list with one list with column names + N lists of values</li>
<li>A list with N dictionaries, all with the same keys</li>
<li>A dictionary with column names and lists of values, all the same length</li>
</ul>
</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="exercise">
<h2 class="exercise">Practice</h2>
<p><strong>Exercise 4</strong>:
Write a <code>requests</code> script that gets the current location and crew roster
of <a href="http://api.open-notify.org/">the International Space Station</a>.</p>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="aside">
<h2 class="aside">Local Web Server</h2>
<p class="inclusion"><a href="src/run_local_server.sh">src/run_local_server.sh</a></p>
<div class="language-sh">
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>http.server<span class="w"> </span>-d<span class="w"> </span>site
</code></pre></div>
</div>
<ul>
<li>Pushing files to GitHub so that we can use them is annoying</li>
<li>And we want to show how to make things <em>wrong</em> so that we can then make them <em>right</em></li>
<li>Use Python&rsquo;s <a href="https://docs.python.org/3/library/http.server.html"><code>http.server</code></a> module
    to run a <a href="#g:local_server">local server</a><ul>
<li>Host name is <a href="#g:localhost"><code>localhost</code></a></li>
<li>Uses <a href="#g:port">port</a> 8000 by default</li>
<li>So URLs look like <code>http://localhost:8000/path/to/file</code></li>
</ul>
</li>
<li><code>-d site</code> tells the server to use <code>site</code> as its root directory</li>
<li>Use this local server for the next few examples<ul>
<li>Build our own server later on to show how it works</li>
</ul>
</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">5: Talk to Local Server</h2>
<p class="inclusion"><a href="src/requests_local_motto.py">src/requests_local_motto.py</a></p>
<div class="language-py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">URL</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:8000/motto.txt&quot;</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;body:</span><span class="se">\n</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<p class="inclusion"><a href="out/requests_local_motto.out">out/requests_local_motto.out</a></p>
<div class="language-plaintext">
<div class="highlight"><pre><span></span><code>::ffff:127.0.0.1 - - [18/Feb/2024 09:12:24] &quot;GET /motto.txt HTTP/1.1&quot; 200 -
status code: 200
body:
Start where you are, use what you have, help who you can.
</code></pre></div>
</div>
<ul>
<li><a href="#g:concurrency">Concurrent</a> systems are hard to debug<ul>
<li>Multiple streams of activity</li>
<li>Order may change from run to run</li>
</ul>
</li>
<li>Use <code>S</code> and <code>c</code> to show output from server and client respectively</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">6: Our Own File Server</h2>
<p class="inclusion"><a href="src/file_server.py">src/file_server.py</a></p>
<div class="language-py">
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">RequestHandler</span><span class="p">(</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">url_path</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39; =&gt; &#39;</span><span class="si">{</span><span class="n">full_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">full_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">ServerException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">full_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">ServerException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2"> not file&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">handle_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">full_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div>
</div>
<ul>
<li>Our <code>RequestHandler</code> handles a single HTTP request<ul>
<li>More specifically, handles the <code>GET</code> method</li>
</ul>
</li>
<li>Combine working directory with requested file path to get local path to file</li>
<li>Return that if it exists and is a file or raise an error</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">7: Support Code</h2>
<ul>
<li>Send content</li>
</ul>
<p class="inclusion"><a href="src/file_server.py">src/file_server.py</a></p>
<div class="language-py">
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">send_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/html; charset=utf-8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div>
</div>
<ul>
<li>Handle errors</li>
</ul>
<p class="inclusion"><a href="src/file_server.py">src/file_server.py</a></p>
<div class="language-py">
<div class="highlight"><pre><span></span><code><span class="n">ERROR_PAGE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2">  &lt;head&gt;&lt;title&gt;Error accessing </span><span class="si">{path}</span><span class="s2">&lt;/title&gt;&lt;/head&gt;</span>
<span class="s2">  &lt;body&gt;</span>
<span class="s2">    &lt;h1&gt;Error accessing </span><span class="si">{path}</span><span class="s2">: </span><span class="si">{msg}</span><span class="s2">&lt;/h1&gt;</span>
<span class="s2">  &lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
</code></pre></div>
</div>
<p class="inclusion"><a href="src/file_server.py">src/file_server.py</a></p>
<div class="language-py">
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">handle_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">ERROR_PAGE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_content</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">HTTPStatus</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">)</span>
</code></pre></div>
</div>
<ul>
<li>Define our own exceptions so we&rsquo;re sure we&rsquo;re only catching what we expect</li>
</ul>
<p class="inclusion"><a href="src/file_server.py">src/file_server.py</a></p>
<div class="language-py">
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ServerException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div>
</div>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">8: Running Our File Server</h2>
<p class="inclusion"><a href="src/file_server.py">src/file_server.py</a></p>
<div class="language-py">
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">serverAddress</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">(</span><span class="n">serverAddress</span><span class="p">,</span> <span class="n">RequestHandler</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;serving in </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</code></pre></div>
</div>
<ul>
<li>And then get <code>motto.txt</code> as before</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">9: Built-in Safety</h2>
<ul>
<li>Modify <code>requests</code> script to take URL as command-line parameter</li>
</ul>
<p class="inclusion"><a href="src/requests_local_url.py">src/requests_local_url.py</a></p>
<div class="language-py">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">URL</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;body:</span><span class="se">\n</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<ul>
<li>Add a sub-directory to <code>site</code> called <code>sandbox</code> with a file <code>example.txt</code></li>
<li>Serve that sub-directory</li>
</ul>
<p class="inclusion"><a href="src/file_server_sandbox.sh">src/file_server_sandbox.sh</a></p>
<div class="language-sh">
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>src/file_server.py<span class="w"> </span>site/sandbox
</code></pre></div>
</div>
<ul>
<li>Can get files from that directory</li>
</ul>
<p class="inclusion"><a href="src/requests_local_url_allowed.sh">src/requests_local_url_allowed.sh</a></p>
<div class="language-sh">
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>src/requests_local_url.py<span class="w"> </span>http://localhost:8000/example.txt
</code></pre></div>
</div>
<p class="inclusion"><a href="out/file_server_allowed.out">out/file_server_allowed.out</a></p>
<div class="language-plaintext">
<div class="highlight"><pre><span></span><code>&#39;/example.txt&#39; =&gt; &#39;/Users/gvwilson/safety/site/sandbox/example.txt&#39;
127.0.0.1 - - [21/Feb/2024 06:04:32] &quot;GET /example.txt HTTP/1.1&quot; 200 -
</code></pre></div>
</div>
<p class="inclusion"><a href="out/requests_local_url_allowed.out">out/requests_local_url_allowed.out</a></p>
<div class="language-plaintext">
<div class="highlight"><pre><span></span><code>status code: 200
body:
example file
</code></pre></div>
</div>
<ul>
<li>But not from parent directory (which isn&rsquo;t part of sandbox)</li>
</ul>
<p class="inclusion"><a href="src/requests_local_url_disallowed.sh">src/requests_local_url_disallowed.sh</a></p>
<div class="language-sh">
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>src/requests_local_url.py<span class="w"> </span>http://localhost:8000/motto.txt
</code></pre></div>
</div>
<p class="inclusion"><a href="out/file_server_disallowed.out">out/file_server_disallowed.out</a></p>
<div class="language-plaintext">
<div class="highlight"><pre><span></span><code>&#39;/motto.txt&#39; =&gt; &#39;/Users/gvwilson/safety/site/sandbox/motto.txt&#39;
127.0.0.1 - - [21/Feb/2024 06:04:38] &quot;GET /motto.txt HTTP/1.1&quot; 404 -
</code></pre></div>
</div>
<p class="inclusion"><a href="out/requests_local_url_disallowed.out">out/requests_local_url_disallowed.out</a></p>
<div class="language-plaintext">
<div class="highlight"><pre><span></span><code>status code: 404
body:
&lt;html&gt;
  &lt;head&gt;&lt;title&gt;Error accessing /motto.txt&lt;/title&gt;&lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Error accessing /motto.txt: /motto.txt not found&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div>
</div>
<ul>
<li>But why not?</li>
<li>Looks like <code>requests</code> is stripping the leading <code>..</code> off the path</li>
<li>And if we try that URL in the browser, same thing happens</li>
<li>So we&rsquo;re safe, right?</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">10: Introducing Telnet</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Telnet">Telnet</a> is short for &ldquo;teletype network&rdquo;, which tells you how old the program is</li>
<li>Open a connection, send exactly what the user types, and show exactly what is sent in response</li>
</ul>
<p class="inclusion"><a href="src/telnet_localhost_8000.sh">src/telnet_localhost_8000.sh</a></p>
<div class="language-sh">
<div class="highlight"><pre><span></span><code>telnet<span class="w"> </span>localhost<span class="w"> </span><span class="m">8000</span>
</code></pre></div>
</div>
<p class="inclusion"><a href="out/telnet_allowed.out">out/telnet_allowed.out</a></p>
<div class="language-plaintext">
<div class="highlight"><pre><span></span><code>Trying 127.0.0.1...
Connected to localhost.
Escape character is &#39;^]&#39;.
GET /example.txt HTTP/1.1

HTTP/1.0 200 OK
Server: BaseHTTP/0.6 Python/3.12.1
Date: Wed, 21 Feb 2024 11:21:22 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 13

example file
Connection closed by foreign host.
</code></pre></div>
</div>
<ul>
<li>So far so good, but:</li>
</ul>
<p class="inclusion"><a href="src/telnet_localhost_8000.sh">src/telnet_localhost_8000.sh</a></p>
<div class="language-sh">
<div class="highlight"><pre><span></span><code>telnet<span class="w"> </span>localhost<span class="w"> </span><span class="m">8000</span>
</code></pre></div>
</div>
<p class="inclusion"><a href="out/telnet_disallowed.out">out/telnet_disallowed.out</a></p>
<div class="language-plaintext">
<div class="highlight"><pre><span></span><code>Trying 127.0.0.1...
Connected to localhost.
Escape character is &#39;^]&#39;.
GET ../motto.txt HTTP/1.1

HTTP/1.0 200 OK
Server: BaseHTTP/0.6 Python/3.12.1
Date: Wed, 21 Feb 2024 11:25:25 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 58

Start where you are, use what you have, help who you can.
Connection closed by foreign host.
</code></pre></div>
</div>
<ul>
<li>If someone doesn&rsquo;t strip out the <code>..</code> characters, users can escape the sandbox</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="aside">
<h2 class="aside">Appendices</h2>
<h3>Terms</h3>
<dl class="glossary">
<dt id="g:client">client</dt><dd>A program such as a browser that sends requests to a server and does something with the response.</dd>

<dt id="g:concurrency">concurrency</dt><dd>The ability of different parts of a system to take action at the same time.</dd>

<dt id="g:http_header">header (of HTTP request or response)</dt><dd>A name-value pair at the start of an <a href="#http_request">HTTP request</a> or <a href="#http_response">response</a>. Headers are used to specify what data formats the sender can handle, the date and time the message was sent, and so on.</dd>

<dt id="g:hostname">hostname</dt><dd>A human-readable name for a computer on a network.</dd>

<dt id="g:http_method">HTTP method</dt><dd>The verb in an <a href="#http_request">HTTP request</a> that defines what the <a href="#client">client</a> wants to do. Common methods are <code>GET</code> (to get data) and <code>POST</code> (to submit data).</dd>

<dt id="g:http_request">HTTP request</dt><dd>A precisely-formatted block of text sent from a <a href="#client">client</a> such as a browser to a <a href="#server">server</a> that specifies what resource is being requested, what data formats the client will accept, etc.</dd>

<dt id="g:http_response">HTTP response</dt><dd>A precisely-formatted block of text sent from a <a href="#server">server</a> back to a <a href="#client">client</a> in reply to a <a href="#http_request">request</a>.</dd>

<dt id="g:http_status_code">HTTP status code</dt><dd>A numerical code that indicates what happened when an <a href="#http_request">HTTP request</a> was processed, such as 200 (OK), 404 (not found), or 500 (internal server error).</dd>

<dt id="g:json">JavaScript Object Notation (JSON)</dt><dd>A way to represent data by combining basic values like numbers and character strings in lists and key-value structures. Unlike other formats, it is unencumbered by a syntax for writing comments.</dd>

<dt id="g:local_server">local server</dt><dd>A <a href="#server">server</a> running on the programmer&rsquo;s own computer, typically for development purposes.</dd>

<dt id="g:localhost">localhost</dt><dd>A special <a href="#hostname">host name</a> that identifies the computer that the software is running on.</dd>

<dt id="g:mime_type">MIME type</dt><dd>A standard that defines types of file content, such as <code>text/plain</code> for plain text and <code>image/jpeg</code> for JPEG images.</dd>

<dt id="g:port">port</dt><dd>A logical endpoint for communication, like a phone number in an office building.</dd>

<dt id="g:server">server</dt><dd>A program that waits for requests from <a href="#client">clients</a> and sends them data in response.</dd>

<dt id="g:socket">socket</dt><dd>A communication channel between two computers that provides an interface similar to reading and writing files.</dd>

<dt id="g:tls_ssl">Transport Layer Security/Secure Sockets Layer (TLS/SSL)</dt><dd>A cryptographic protocol for secure communication over a computer network.</dd>

<dt id="g:web_scraping">web scraping</dt><dd>The act of extracting data from HTML pages on the web.</dd>
</dl>
<h3>Acknowledgments</h3>
<ul><li>Jean-Marc Saffroy</li></ul>
<h3>Links</h3>
<ul>
<li><em>Teaching Tech Together</em>: <a href="https://teachtogether.tech/">https://teachtogether.tech/</a></li>
<li><em>Teaching Tech Together</em> lesson on learner personas: <a href="http://teachtogether.tech/en/index.html#s:process-personas">http://teachtogether.tech/en/index.html#s:process-personas</a></li>
<li>Open Notify API for the International Space Station: <a href="http://api.open-notify.org/">http://api.open-notify.org/</a></li>
<li>Python <code>http.server</code> module: <a href="https://docs.python.org/3/library/http.server.html">https://docs.python.org/3/library/http.server.html</a></li>
<li>Telnet: <a href="https://en.wikipedia.org/wiki/Telnet">https://en.wikipedia.org/wiki/Telnet</a></li>
<li>The Carpentries: <a href="https://carpentries.org/">https://carpentries.org/</a></li>
<li>Wikipedia article on HTTP status codes: <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">https://en.wikipedia.org/wiki/List_of_HTTP_status_codes</a></li>
<li><code>requests</code> module: <a href="https://requests.readthedocs.io/en/latest/">https://requests.readthedocs.io/en/latest/</a></li>
</ul>
</section>
    </main>
    <footer>
  <i class="fa fa-copyright"></i> 2024 Greg Wilson
  &middot;
  <a href="mailto:gvwilson@third-bit.com"><i class="fas fa-envelope-square" aria-hidden="true" title="author email"></i></a>
  <a href="https://github.com/gvwilson/safety-tutorial"><i class="fab fa-github" aria-hidden="true" title="GitHub repository"></i></a>
  <a href="license/"><i class="fab fa-creative-commons-by" aria-hidden="true" title="license"></i></a>
  &middot;
  <time datetime="2024-02-21">Last built 2024-02-21</time>
</footer>

  </body>
</html>
